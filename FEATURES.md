# 任务分配系统 - 功能说明文档

## 系统概述

本系统包含两个钉钉微应用，用于企业内部的任务分配与管理：

- **人工任务分配**（管理员端）：供经理/管理员使用，进行任务分配和员工管理
- **我的任务管理**（员工端）：供员工使用，查看任务、管理日程、执行工作

---

# 一、人工任务分配（管理员端）

## 1. 登录与身份验证

- 支持钉钉免密登录，自动识别管理员身份
- 显示当前登录的管理员姓名
- 支持退出登录

## 2. 技能池管理

### 2.1 技能列表
- 以"砖块"形式展示所有技能
- 每个技能显示名称
- 支持点击选中/取消选中

### 2.2 技能操作
- **添加技能**：输入技能名称，点击添加
- **删除技能**：点击技能上的删除按钮移除（自动清理关联数据）

### 2.3 数据隔离
- 每个管理员只能看到和管理自己创建的技能

## 3. 任务库管理

### 3.1 任务列表
- 展示所有任务卡片
- 显示任务名称、描述、截止日期、预计耗时、重要程度
- 显示任务所需技能标签

### 3.2 创建任务
- **必填项**：任务名称、截止日期、预计耗时（小时）
- **选填项**：任务描述、重要度说明
- **技能选择**：从技能池中点选所需技能（至少选择一个）
- **重要程度**：1-10分滑块选择，带颜色指示（绿→黄→红）

### 3.3 编辑任务
- 修改任务的所有属性
- 重新选择所需技能
- 调整重要程度

### 3.4 删除任务
- 删除任务及其所有关联数据

## 4. 员工管理

### 4.1 员工列表
- 展示所有员工卡片
- 显示员工姓名、钉钉ID
- 显示员工技能及评分

### 4.2 添加员工
- **必填项**：员工姓名、钉钉用户ID
- **技能配置**：
  - 动态添加技能行
  - 下拉框选择技能（从技能池）
  - 滑块设置技能评分（1-10分）
  - 支持删除技能行

### 4.3 编辑员工
- 修改员工基本信息
- 调整员工技能及评分
- 添加或删除技能

### 4.4 删除员工
- 删除员工及其所有关联数据

### 4.5 数据隔离
- 每个管理员只能看到和管理自己添加的员工

## 5. 任务分配

### 5.1 手动分配
- **选择任务**：下拉框选择待分配任务
  - 选择后显示任务所需技能（橙色标签）
- **选择员工**：下拉框选择目标员工
  - 选择后显示员工技能及评分（绿色标签）
  - 自动显示技能匹配情况
- **发送分配**：创建分配记录并发送钉钉通知

### 5.2 智能自动分配
- **配置参数**：
  - 技能匹配阈值（默认80%）
  - 负载阈值（默认85%）
  - 是否启用负载平衡
- **运行算法**：自动为所有未分配任务匹配最佳员工
- **预览结果**：
  - 显示统计卡片（待分配数、成功匹配数、未能匹配数）
  - 显示员工负载变化预览（分配前/后负载对比）
  - 显示任务延期风险预警
  - 显示每条分配的详细评分明细
  - 显示未能分配的任务及原因
- **调整结果**：可移除单条不满意的分配
- **确认分配**：批量创建分配记录并发送钉钉通知

## 6. 分配记录

### 6.1 记录列表
- 显示所有任务分配记录
- 每条记录显示：任务名称、分配员工、分配时间、当前状态

### 6.2 状态显示
- **待处理**：员工尚未响应
- **已接受/进行中**：员工已接受任务
- **已拒绝**：员工拒绝任务，显示拒绝理由
- **已完成**：任务已完成

### 6.3 完成情况查看
- 查看员工提交的完成情况
- 查看实际用时
- 查看完成说明

### 6.4 经理评价
- 对已完成任务进行评价
- **效率评分**：1-10分
- **质量评分**：1-10分
- **评审意见**：文字评价
- 评价结果保存并可查看

---

# 二、我的任务管理（员工端）

## 1. 登录与身份验证

- 支持钉钉免密登录，自动识别员工身份
- 支持手动输入钉钉ID登录（调试用）
- 登录状态持久化（刷新页面不丢失）
- 支持退出登录

## 2. 我的任务

### 2.1 任务统计
- 显示待处理任务数
- 显示进行中任务数
- 显示已完成任务数

### 2.2 经理任务
- 显示经理分配的所有任务
- 按截止日期排序
- 每个任务显示：
  - 任务名称、描述
  - 截止日期（带颜色提示：红色=紧急、橙色=临近、绿色=充裕）
  - 分配日期
  - 分配经理
  - 当前状态
- **待处理任务**：可接受或拒绝
- **已完成任务**：显示完成标识，可填写/查看完成情况

### 2.3 自主任务
- 显示员工自己创建的任务
- **添加任务**：
  - 任务名称（必填）
  - 预计耗时（必填）
  - 任务类型：项目类任务/临时事务/个人学习
  - 截止日期（选填）
  - 任务描述（选填）
- **删除任务**：删除未完成的任务
- **已完成任务**：显示完成标识，可填写/查看完成记录

### 2.4 不可用时间
- 管理出差、会议、培训、请假等占用时间
- **添加不可用时间**：
  - 日期（必填）
  - 开始时间（必填）
  - 结束时间（必填）
  - 原因类型：会议/出差/培训/请假/其他
  - 备注说明（选填）
- **删除不可用时间**：移除记录

### 2.5 完成情况填写
- 任务完成后可填写完成情况
- **填写内容**：
  - 实际用时（小时）
  - 完成说明
- 经理任务提交后等待经理评价
- 自主任务保存完成记录

### 2.6 日程更新提醒
- 任何任务变动（接受/新增/删除）后显示提醒
- 提醒用户去更新日程
- 可点击"去更新"直接跳转
- 10秒后自动消失

## 3. 我的负载

### 3.1 负载概览
- **圆环进度条**：显示本周负载指数百分比
- **负载等级**：
  - 较轻（<50%）- 绿色
  - 中等（50-80%）- 黄色
  - 高负载（80-100%）- 橙色
  - 超负荷（>100%）- 红色

### 3.2 时间分配饼图
- 显示本周时间构成：
  - 经理任务工时
  - 自主任务工时
  - 不可用时间
  - 空闲时间

### 3.3 每日负载柱状图
- 显示本周每天的工作负载
- 对比每天的任务分布

### 3.4 统计卡片
- 本周总可用工时
- 经理任务工时
- 自主任务工时
- 不可用时间

### 3.5 任务详情列表
- 显示每个任务的本周分摊工时
- 区分经理任务和自主任务

## 4. 日程制定

### 4.1 权重配置
- **交互式饼图**：可视化显示三种权重占比
- **三种权重**：
  - 🚨 紧急度：截止日期越近越优先
  - ⭐ 重要度：重要性评分越高越优先
  - 🔗 连续性：同一任务连续完成
- **调整方式**：点击+/-按钮调整，总和始终为100%

### 4.2 任务重要性设置
- **经理任务**：显示经理设定的重要度，员工可补充自己认为的重要度
- **自主任务**：设置任务的重要度（1-10分）

### 4.3 自动排程
- 点击"自动排程"生成未来2周的日程安排
- 按优先级自动分配每天的任务

### 4.4 日程结果显示
- **排程信息**：显示排程周期、每日工时、生成时间
- **每日安排**：
  - 显示日期和星期
  - 显示当日不可用时间（原因、时段、时长）
  - 显示当日任务列表
  - 每个任务显示：名称、类型、计划工时、进度环
- **进度环**：圆形百分比显示任务完成进度
- **延期统计**：
  - 延期率、风险率
  - 延期任务数、高风险任务数
  - 未排工时总数
  - 延期任务详情（延期天数、剩余工时）
- **风险预警列表**：显示有延期风险的任务

### 4.5 接受日程
- 查看日程后点击"接受此日程"
- 接受后日程生效，显示接受时间
- "开始工作"模块按此日程执行

### 4.6 更新日程
- **更新入口**：已有日程时显示"更新日程"按钮
- **更新提示**：有新任务时显示提示横幅
- **选择保留**：
  - 进入更新模式
  - 显示当前所有日程项
  - 勾选要保留的任务安排
  - 保留的任务保持原时间段不变
- **重新排程**：未选中的任务重新安排
- **保存接受**：确认新日程

## 5. 开始工作

### 5.1 日期切换
- 显示今日和未来两个工作日
- 点击切换查看不同日期的任务

### 5.2 任务列表
- 显示当日待执行的任务
- 每个任务显示：
  - 任务名称、类型
  - 计划工时
  - 当前状态
  - 截止日期

### 5.3 工作计时
- **开始工作**：点击开始计时
- **实时计时器**：显示已工作时长（时:分:秒）
- **中断任务**：
  - 暂停计时
  - 填写中断理由
  - 记录中断时间
- **恢复工作**：
  - 继续计时
  - 显示中断记录
- **完成任务**：结束计时，任务标记完成

### 5.4 状态显示
- **待开始**：未开始的任务
- **进行中**：正在执行的任务，显示计时器
- **已暂停**：中断的任务，显示中断记录
- **已完成**：完成的任务

### 5.5 超时提醒
- **正在加班中**：实际时间超过预估，但任务不是今天结束
- **已超时**：实际时间超过预估，且任务应今天完成

### 5.6 完成后操作
- 任务完成后显示"填写完成情况"按钮
- 点击跳转到"我的任务"填写详情

### 5.7 日程提醒
- 无日程时：引导去制定日程
- 有待接受日程时：提示去接受
- 有新任务需更新时：顶部显示更新提示

---

# 三、算法说明

## 1. 智能自动分配算法（管理员端）

### 1.1 算法目标
为未分配的任务自动匹配最合适的员工，同时考虑技能匹配、员工负载、任务紧急性等因素。

### 1.2 执行流程

```
步骤1：任务排序
    ↓ 按重要性降序排列
    ↓ 同等重要性按截止日期升序排列
    
步骤2：对每个任务筛选候选员工
    ↓ 计算技能匹配度 = 员工具备的所需技能数 / 任务所需技能总数
    ↓ 筛选条件：匹配度 ≥ 阈值（默认80%）
    ↓ 筛选条件：当前负载 < 阈值（默认85%）
    
步骤3：对候选员工评分（总分100分）
    ├─ 技能匹配度（40分）：匹配度越高分越高
    ├─ 技能评分（20分）：员工对所需技能的平均评分
    ├─ 负载指数（25分）：负载越低分越高
    └─ 工时匹配（15分）：剩余可用工时能否覆盖任务耗时
    
步骤4：分配任务
    ↓ 选择评分最高的员工
    ↓ 更新该员工的模拟负载数据
    ↓ 继续处理下一个任务
    
步骤5：生成结果
    ├─ 成功匹配的任务列表
    ├─ 未能匹配的任务及原因
    ├─ 员工负载变化预览
    └─ 任务延期风险评估
```

### 1.3 负载平衡检测
- 检测分配后员工间负载差异
- 差异超过30%时提示管理员手动调整

### 1.4 延期风险评估
- **已逾期**：截止日期已过
- **紧急**：今日截止
- **高风险**：任务耗时 > 剩余工作时间
- **中风险**：员工负载>90% 或 剩余≤3天

---

## 2. 日程排程算法（员工端）

### 2.1 算法目标
根据员工的所有任务、不可用时间，自动生成未来两周的每日工作安排。

### 2.2 输入数据
- 经理分配的任务（待处理+进行中）
- 员工自主任务（待完成）
- 不可用时间记录
- 用户设置的权重（紧急度/重要度/连续性）
- 用户指定的锁定日程项（更新时）

### 2.3 执行流程

```
步骤1：收集任务信息
    ├─ 经理任务：获取预计耗时、截止日期、重要度
    │   └─ 综合重要度 = (经理重要度 + 员工重要度) / 2
    └─ 自主任务：获取预计耗时、截止日期、重要度

步骤2：计算优先级得分
    对每个任务计算：
    ├─ 紧急度（根据截止日期）：
    │   ├─ 已逾期 → 10分
    │   ├─ ≤3天 → 8分
    │   ├─ ≤7天 → 6分
    │   └─ >7天 → 4分
    └─ 优先级得分 = (紧急度 × 紧急权重 + 重要度 × 重要权重) / (紧急权重 + 重要权重)

步骤3：任务排序
    ↓ 按优先级得分降序排列

步骤4：计算每日可用工时
    对每个工作日：
    ├─ 基础工时 = 8小时
    ├─ 减去不可用时间
    └─ 减去已锁定的日程项工时（更新时）

步骤5：分配任务到每天
    对每个任务（按优先级顺序）：
    ├─ 从最近的工作日开始
    ├─ 每日最多分配4小时给同一任务（保证连续性）
    ├─ 分配工时 = min(任务剩余工时, 当日可用工时, 4小时)
    ├─ 更新当日剩余可用工时
    └─ 继续分配直到任务工时全部排完

步骤6：处理锁定项（更新模式）
    ├─ 锁定的日程项保持原位置不变
    ├─ 从任务总工时中扣除已锁定的工时
    └─ 只对剩余工时重新排程

步骤7：计算进度和风险
    对每个任务：
    ├─ 计算累计已排工时
    ├─ 计算完成进度百分比
    ├─ 评估延期风险
    └─ 统计延期天数和剩余工时

步骤8：生成结果
    ├─ 每日日程安排（任务列表+不可用时间）
    ├─ 任务进度信息
    ├─ 延期风险列表
    └─ 延期统计数据
```

### 2.4 分摊法说明
任务工时按工作日均匀分摊：
```
例：一个20小时的任务，周期为12月2日-12月13日（10个工作日）
每日分摊 = 20h ÷ 10天 = 2h/天

本周（5个工作日）应完成 = 2h × 5 = 10h
```

### 2.5 更新排程逻辑
1. 用户选择要保留的日程项
2. 计算每个任务已锁定的工时
3. 任务剩余工时 = 总工时 - 已锁定工时
4. 对剩余工时重新排程
5. 合并锁定项和新排程项

---

# 四、数据隔离说明

## 管理员端
- 每个管理员只能看到自己创建的：
  - 技能池
  - 任务库
  - 员工列表
  - 分配记录

## 员工端
- 每个员工只能看到：
  - 分配给自己的任务
  - 自己创建的自主任务
  - 自己的不可用时间
  - 自己的日程和工作记录

---

# 五、通知机制

- 任务分配时自动发送钉钉通知给员工
- 通知包含：任务名称、截止日期、分配人
- 员工可通过通知直接跳转查看任务详情

---

**文档版本**：v2.0  
**更新日期**：2025年12月7日

